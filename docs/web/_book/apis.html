<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Engaging the Web with R</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="An introduction to using R for the web.">
  <meta name="generator" content="bookdown 0.1.7 and GitBook 2.6.7">

  <meta property="og:title" content="Engaging the Web with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An introduction to using R for the web." />
  <meta name="github-repo" content="m-clark/Workshops" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Engaging the Web with R" />
  
  <meta name="twitter:description" content="An introduction to using R for the web." />
  

<meta name="author" content="Michael Clark">

<meta name="date" content="2016-10-12">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="web-scraping.html">
<link rel="next" href="visualization.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-0.7/htmlwidgets.js"></script>
<link href="libs/plotlyjs-1.16.3/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotlyjs-1.16.3/plotly-latest.min.js"></script>
<script src="libs/plotly-binding-4.5.2/plotly.js"></script>
<link href="libs/leaflet-0.7.3/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-0.7.3/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/leaflet-binding-1.0.1/leaflet.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="webR.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><span style="font-size:150%; font-variant:small-caps; font-style:italic; color:#ff5503">webR</span></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="web-scraping.html"><a href="web-scraping.html"><i class="fa fa-check"></i><b>1</b> Web scraping</a><ul>
<li class="chapter" data-level="1.1" data-path="web-scraping.html"><a href="web-scraping.html#direct-data-download"><i class="fa fa-check"></i><b>1.1</b> Direct data download</a></li>
<li class="chapter" data-level="1.2" data-path="web-scraping.html"><a href="web-scraping.html#key-concepts"><i class="fa fa-check"></i><b>1.2</b> Key concepts</a></li>
<li class="chapter" data-level="1.3" data-path="web-scraping.html"><a href="web-scraping.html#the-basic-approach"><i class="fa fa-check"></i><b>1.3</b> The basic approach</a></li>
<li class="chapter" data-level="1.4" data-path="web-scraping.html"><a href="web-scraping.html#examples"><i class="fa fa-check"></i><b>1.4</b> Examples</a><ul>
<li class="chapter" data-level="1.4.1" data-path="web-scraping.html"><a href="web-scraping.html#tables"><i class="fa fa-check"></i><b>1.4.1</b> Tables</a></li>
<li class="chapter" data-level="1.4.2" data-path="web-scraping.html"><a href="web-scraping.html#text"><i class="fa fa-check"></i><b>1.4.2</b> Text</a></li>
<li class="chapter" data-level="1.4.3" data-path="web-scraping.html"><a href="web-scraping.html#images"><i class="fa fa-check"></i><b>1.4.3</b> Images</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="web-scraping.html"><a href="web-scraping.html#issues"><i class="fa fa-check"></i><b>1.5</b> Issues</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="apis.html"><a href="apis.html"><i class="fa fa-check"></i><b>2</b> APIs</a><ul>
<li class="chapter" data-level="2.1" data-path="apis.html"><a href="apis.html#raw-example"><i class="fa fa-check"></i><b>2.1</b> Raw Example</a></li>
<li class="chapter" data-level="2.2" data-path="apis.html"><a href="apis.html#r-packages"><i class="fa fa-check"></i><b>2.2</b> R packages</a><ul>
<li class="chapter" data-level="2.2.1" data-path="apis.html"><a href="apis.html#new-york-times-article-search"><i class="fa fa-check"></i><b>2.2.1</b> New York Times Article Search</a></li>
<li class="chapter" data-level="2.2.2" data-path="apis.html"><a href="apis.html#wikipedia-1"><i class="fa fa-check"></i><b>2.2.2</b> Wikipedia</a></li>
<li class="chapter" data-level="2.2.3" data-path="apis.html"><a href="apis.html#qualtrics"><i class="fa fa-check"></i><b>2.2.3</b> Qualtrics</a></li>
<li class="chapter" data-level="2.2.4" data-path="apis.html"><a href="apis.html#others"><i class="fa fa-check"></i><b>2.2.4</b> Others</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="apis.html"><a href="apis.html#issues-1"><i class="fa fa-check"></i><b>2.3</b> Issues</a><ul>
<li class="chapter" data-level="2.3.1" data-path="apis.html"><a href="apis.html#documentation"><i class="fa fa-check"></i><b>2.3.1</b> Documentation</a></li>
<li class="chapter" data-level="2.3.2" data-path="apis.html"><a href="apis.html#api-changes"><i class="fa fa-check"></i><b>2.3.2</b> API Changes</a></li>
<li class="chapter" data-level="2.3.3" data-path="apis.html"><a href="apis.html#broken-api"><i class="fa fa-check"></i><b>2.3.3</b> Broken API</a></li>
<li class="chapter" data-level="2.3.4" data-path="apis.html"><a href="apis.html#restrictions"><i class="fa fa-check"></i><b>2.3.4</b> Restrictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>3</b> Visualization</a><ul>
<li class="chapter" data-level="3.1" data-path="visualization.html"><a href="visualization.html#systems"><i class="fa fa-check"></i><b>3.1</b> Systems</a><ul>
<li class="chapter" data-level="3.1.1" data-path="visualization.html"><a href="visualization.html#plotly"><i class="fa fa-check"></i><b>3.1.1</b> plotly</a></li>
<li class="chapter" data-level="3.1.2" data-path="visualization.html"><a href="visualization.html#rbokeh"><i class="fa fa-check"></i><b>3.1.2</b> rbokeh</a></li>
<li class="chapter" data-level="3.1.3" data-path="visualization.html"><a href="visualization.html#others-1"><i class="fa fa-check"></i><b>3.1.3</b> Others</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="visualization.html"><a href="visualization.html#htmlwidgets"><i class="fa fa-check"></i><b>3.2</b> htmlwidgets</a><ul>
<li class="chapter" data-level="3.2.1" data-path="visualization.html"><a href="visualization.html#leaflet-example"><i class="fa fa-check"></i><b>3.2.1</b> Leaflet example</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="visualization.html"><a href="visualization.html#shiny"><i class="fa fa-check"></i><b>3.3</b> Shiny</a><ul>
<li class="chapter" data-level="3.3.1" data-path="visualization.html"><a href="visualization.html#server"><i class="fa fa-check"></i><b>3.3.1</b> Server</a></li>
<li class="chapter" data-level="3.3.2" data-path="visualization.html"><a href="visualization.html#ui"><i class="fa fa-check"></i><b>3.3.2</b> UI</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="visualization.html"><a href="visualization.html#dashboards"><i class="fa fa-check"></i><b>3.4</b> Dashboards</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="publishing.html"><a href="publishing.html"><i class="fa fa-check"></i><b>4</b> Publishing</a><ul>
<li class="chapter" data-level="4.1" data-path="publishing.html"><a href="publishing.html#publishing-languages"><i class="fa fa-check"></i><b>4.1</b> Publishing Languages</a><ul>
<li class="chapter" data-level="4.1.1" data-path="publishing.html"><a href="publishing.html#markdown"><i class="fa fa-check"></i><b>4.1.1</b> Markdown</a></li>
<li class="chapter" data-level="4.1.2" data-path="publishing.html"><a href="publishing.html#r-markdown"><i class="fa fa-check"></i><b>4.1.2</b> R Markdown</a></li>
<li class="chapter" data-level="4.1.3" data-path="publishing.html"><a href="publishing.html#html-css-etc."><i class="fa fa-check"></i><b>4.1.3</b> HTML, CSS etc.</a></li>
<li class="chapter" data-level="4.1.4" data-path="publishing.html"><a href="publishing.html#latex"><i class="fa fa-check"></i><b>4.1.4</b> <span class="math inline">\(\LaTeX\)</span></a></li>
<li class="chapter" data-level="4.1.5" data-path="publishing.html"><a href="publishing.html#yaml"><i class="fa fa-check"></i><b>4.1.5</b> YAML</a></li>
<li class="chapter" data-level="4.1.6" data-path="publishing.html"><a href="publishing.html#pandoc"><i class="fa fa-check"></i><b>4.1.6</b> Pandoc</a></li>
<li class="chapter" data-level="4.1.7" data-path="publishing.html"><a href="publishing.html#summary"><i class="fa fa-check"></i><b>4.1.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="publishing.html"><a href="publishing.html#document-formats"><i class="fa fa-check"></i><b>4.2</b> Document Formats</a><ul>
<li class="chapter" data-level="4.2.1" data-path="publishing.html"><a href="publishing.html#html"><i class="fa fa-check"></i><b>4.2.1</b> HTML</a></li>
<li class="chapter" data-level="4.2.2" data-path="publishing.html"><a href="publishing.html#notebooks"><i class="fa fa-check"></i><b>4.2.2</b> Notebooks</a></li>
<li class="chapter" data-level="4.2.3" data-path="publishing.html"><a href="publishing.html#print"><i class="fa fa-check"></i><b>4.2.3</b> Print</a></li>
<li class="chapter" data-level="4.2.4" data-path="publishing.html"><a href="publishing.html#journals"><i class="fa fa-check"></i><b>4.2.4</b> Journals</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="publishing.html"><a href="publishing.html#presentations"><i class="fa fa-check"></i><b>4.3</b> Presentations</a></li>
<li class="chapter" data-level="4.4" data-path="publishing.html"><a href="publishing.html#other-formats"><i class="fa fa-check"></i><b>4.4</b> Other formats</a></li>
<li class="chapter" data-level="4.5" data-path="publishing.html"><a href="publishing.html#other"><i class="fa fa-check"></i><b>4.5</b> Other</a><ul>
<li class="chapter" data-level="4.5.1" data-path="publishing.html"><a href="publishing.html#customization"><i class="fa fa-check"></i><b>4.5.1</b> Customization</a></li>
<li class="chapter" data-level="4.5.2" data-path="publishing.html"><a href="publishing.html#rpubs"><i class="fa fa-check"></i><b>4.5.2</b> Rpubs</a></li>
<li class="chapter" data-level="4.5.3" data-path="publishing.html"><a href="publishing.html#more"><i class="fa fa-check"></i><b>4.5.3</b> More</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i>Conclusion</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://m-clark.github.io" target="blank">Michael Clark</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><span style="font-size:150%; font-variant:small-caps; font-style:italic; color:#1e90ff">Engaging the Web with R</span></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="apis" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> APIs</h1>
<p>An <span class="emph">application programming interface</span> allows one to interact with a website. In the simplest situation, this is merely a url-based approach to grabbing what you need.</p>
<p>As an example consider the following generic url:</p>
<p><code>http://somewebsite.com/key?par1;par2</code></p>
<p>The key ingredients are:</p>
<ul>
<li>the base url</li>
<li>some authorization component (e.g. key)</li>
<li>the parameters of interest that specify what you want to grab from that website.</li>
</ul>
<p>With R, once we have authorization we can then simply feed the parameters that tell the server what data to provide. We can do this in a raw fashion, where we make the url, or web address<a href="#fn8" class="footnoteRef" id="fnref8"><sup>8</sup></a>, that has the necessary specification, and then simply take what it provides. Alternatively, there are many R packages to make the process easier for things like Twitter, Qualtrics, and many other websites.</p>
<div id="raw-example" class="section level2">
<h2><span class="header-section-number">2.1</span> Raw Example</h2>
<p>Basic functions of the raw approach are requests to a server things like GET and POST, commands that tell the server to provide something or perhaps provide data to it. In the following, <span class="objclass">api_key</span><a href="#fn9" class="footnoteRef" id="fnref9"><sup>9</sup></a> is an R object with a character string of the key provided to me by the website. I use the <span class="pack">httr</span> package for the web functionality to acquire the content. In particular, the <span class="func">GET</span> function retrieves whatever information is noted by the request/url. Additional arguments or modifications to the base url can also be provided, which is what the <code>query</code> part does.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># raw approach</span>
<span class="kw">library</span>(httr)
most_viewed_base =<span class="st"> </span><span class="kw">GET</span>(<span class="st">&#39;https://api.nytimes.com/svc/mostpopular/v2/mostviewed/all-sections/30.json&#39;</span>, <span class="dt">query=</span><span class="kw">list</span>(<span class="st">`</span><span class="dt">api-key</span><span class="st">`</span>=api_key))
<span class="co"># see the url created</span>
<span class="co"># most_viewed_base$url # tacks on ?api-key=YOURAPI at the end</span></code></pre></div>
<p>At this point, <span class="objclass">most_viewed_base</span> is a <span class="objclass">response</span> class object, a list with several pieces of information including what we want, which is the content.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(most_viewed_base[-<span class="dv">1</span>], <span class="dv">1</span>)</code></pre></div>
<pre><code>List of 9
 $ status_code: int 200
 $ headers    :List of 16
  ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;insensitive&quot; &quot;list&quot;
 $ all_headers:List of 1
 $ cookies    :&#39;data.frame&#39;:    0 obs. of  7 variables:
 $ content    : raw [1:54928] 7b 22 73 74 ...
 $ date       : POSIXct[1:1], format: &quot;2016-10-12 19:31:40&quot;
 $ times      : Named num [1:6] 0 0.031 0.078 0.125 0.187 0.218
  ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;redirect&quot; &quot;namelookup&quot; &quot;connect&quot; &quot;pretransfer&quot; ...
 $ request    :List of 7
  ..- attr(*, &quot;class&quot;)= chr &quot;request&quot;
 $ handle     :Class &#39;curl_handle&#39; &lt;externalptr&gt; </code></pre>
<p>However the content’s in binary, and to get it into a useful state we’ll use the <span class="func">content</span> function. The rest of the code just takes the title and arranges it by date.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">most_viewed =<span class="st"> </span><span class="kw">content</span>(most_viewed_base)
<span class="kw">lapply</span>(most_viewed$results, function(x) <span class="kw">data_frame</span>(<span class="dt">title=</span>x$title, <span class="dt">date=</span>x$published_date)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">bind_rows</span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(date))</code></pre></div>
<pre><code># A tibble: 20 × 2
                                                                                               title       date
                                                                                               &lt;chr&gt;      &lt;chr&gt;
1                                                                         Latest Election Polls 2016 2016-10-12
2                                                     2016 Election Forecast: Who Will Be President? 2016-10-12
3                             Paul Ryan Turns Focus From Donald Trump to House Races, Roiling G.O.P. 2016-10-11
4                                                        Presidential Debate: Heres What You Missed 2016-10-10
5                                                      Fact Checks of the Second Presidential Debate 2016-10-09
6                                                                      Donald Trump, Groper in Chief 2016-10-09
7                                            Donald Trump Apology Caps Day of Outrage Over Lewd Tape 2016-10-08
8                                           A Letter to the Doctors and Nurses Who Cared for My Wife 2016-10-06
9  Donald Trump Tax Records Show He Could Have Avoided Taxes for Nearly Two Decades, The Times Found 2016-10-02
10                                     After a Disappointing Debate, Donald Trump Goes on the Attack 2016-09-28
11                                     Did You Miss the Presidential Debate? Here Are the Highlights 2016-09-27
12                                                               Our Fact Checks of the First Debate 2016-09-27
13                                                          Why Donald Trump Should Not Be President 2016-09-26
14                                            Video by Wife of Keith Scott Shows Her Pleas to Police 2016-09-24
15                                                              A Week of Whoppers From Donald Trump 2016-09-24
16                                          Angelina Jolie to Divorce Brad Pitt, Ending Brangelina 2016-09-22
17                                Ahmad Khan Rahami Is Arrested in Manhattan and New Jersey Bombings 2016-09-20
18                              Powerful Blast Injures at Least 29 in Manhattan; Second Device Found 2016-09-18
19                                                       How the Sugar Industry Shifted Blame to Fat 2016-09-13
20                        Hillary Clintons Doctor Says Pneumonia Led to Abrupt Exit From 9/11 Event 2016-09-12</code></pre>
<p>The community API can get user comments and movie reviews. In the following case, it will need a specific date to retrieve comments.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">comments_base =<span class="st"> </span><span class="kw">GET</span>(<span class="st">&#39;http://api.nytimes.com/svc/community/v3/user-content/by-date.json&#39;</span>, <span class="dt">query=</span><span class="kw">list</span>(<span class="dt">date=</span><span class="kw">Sys.Date</span>()))
comments =<span class="st"> </span><span class="kw">content</span>(comments_base)
<span class="kw">sapply</span>(comments$results$comments, function(x) x$commentBody)[<span class="dv">1</span>:<span class="dv">5</span>]</code></pre></div>
<pre><code>[1] &quot;As ugly as I thought the \&quot;republicans\&quot; were or could be, has been dramatically eclipsed, by the vulgarity that is. &lt;br/&gt;&lt;br/&gt;What an embarrassment for our country.&lt;br/&gt;Talk about \&quot;the ugly American\&quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
[2] &quot;The Great Depression gave FDR the conditions to enable Social Security, Worker Rights and Unemployment Insurance to become a reality. If Trump \&quot;enables\&quot; the Democrats with filibuster-proof majorities in the Congress, they must treat it as a great chance for long-sought and long-needed projects like single payer national health care and income tax reforms that are truly progressive.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[3] &quot;I heard, many people are saying, that Hillary is sending money to Donald so he can continue his meltdown. It&#39;s what people say...&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
[4] &quot;Nominee Trump is a demagogue--one to be classed with the likes of Louisiana&#39;s Gov. Huey Long.&lt;br/&gt;&lt;br/&gt;It is ironic that the demagogic Trump has now turned on the demagogic party that spawned him--and that party leaders are waiting for further polls before deciding how to pay him back in kind.&lt;br/&gt;&lt;br/&gt;Perhaps, however, it is time to turn away from our fixation on an individual demagogue and focus on the far graver threat: the institutionalized demagoguery of the GOP itself.&lt;br/&gt;&lt;br/&gt;Demagoguery effectively shuts down rational discourse and reflective consideration of alternative solutions to our many problems.&lt;br/&gt;&lt;br/&gt;Isn&#39;t that what the Grand Obstructionist Party is all about?&lt;br/&gt;&lt;br/&gt;Among the GOP&#39;s demagogic strategies are appeals to divisive \&quot;social/moral\&quot; issues, identification with a shallow militaristic \&quot;patriotism\&quot; and a&lt;br/&gt;narrow Christian fundamentalism, obstructionist Hastert rules and Norquist pledges, etc.&lt;br/&gt;&lt;br/&gt;While pursuing these strategies, many GOP politicians and spokespersons--not just candidate Donald Trump--employ the demagogue&#39;s favored techniques on a daily basis: gross oversimplification, fear mongering, scapegoating, emotional appeals, accusations that opponents are disloyal or weak, attacks on the news media, obstructive refusals of all compromise--and, yes, bald faced lies.&lt;br/&gt;&lt;br/&gt;Donald Trump&#39;s candidacy is the symptom, not the disease.&lt;br/&gt;&lt;br/&gt;The voters can readily reject this individual buffoonish demagogue.&lt;br/&gt;&lt;br/&gt;But just who will reform this cadaverous Republican Party?&quot;
[5] &quot;It looks like both parties&#39; pollsters seem aligned on the direction of the race, though they await a new round of polling to see where to allocate resources. Trump retains the support of his base but is losing soft supporters and independents while Hillary Clinton continues to gain among millennials, white females without college degrees and will likely have the largest margin among latino voters that we&#39;ve ever seen. The gap between the Democratic and Republican nominees among white voters is the lowest it has been since Bill Clinton won re-election in 1996. It stands to reason that Hillary Clinton will have a margin of victory that aligns to the results in 2008 or 1996.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </code></pre>
<p>The API documentation doesn’t make obvious what the date format should be, how the commments are chosen (aside from being taken from some section of the paper), or what the limits are. As mentioned previously, this is typical API documentation in my experience.</p>
</div>
<div id="r-packages" class="section level2">
<h2><span class="header-section-number">2.2</span> R packages</h2>
<p>Many R packages allow extremely easy access to various websites through their API. Usually all it takes is acquiring the authorization and the package will do the rest. It might only be marginally less effort than the raw approach we did before, but can make things more efficient in the long run.</p>
<div id="new-york-times-article-search" class="section level3">
<h3><span class="header-section-number">2.2.1</span> New York Times Article Search</h3>
<p>The following is an example of accessing the New York Times artical search API<a href="#fn10" class="footnoteRef" id="fnref10"><sup>10</sup></a>. Using the <span class="pack">rtimes</span> package, we can use a function similar to any other in R. In this case we need a query, beginning date and an end date to collect articles that contain the text of the query. Note that it still requires an key, but that’s not shown here.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rtimes)
article_search =<span class="st"> </span><span class="kw">as_search</span>(<span class="dt">q=</span><span class="st">&quot;bomb&quot;</span>, <span class="dt">begin_date =</span> <span class="st">&#39;20160918&#39;</span>, <span class="dt">end_date =</span> <span class="st">&#39;20160919&#39;</span>)[-(<span class="dv">1</span>:<span class="dv">2</span>)]

<span class="kw">lapply</span>(article_search$data, function(x) <span class="kw">data_frame</span>(<span class="dt">snippet=</span>x$snippet, <span class="dt">date=</span> x$pub_date)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">bind_rows</span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(date))</code></pre></div>
</div>
<div id="wikipedia-1" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Wikipedia</h3>
<p>With the <span class="pack">WikipediR</span> package, getting the whole content of a page is just one possibility, and it feeds nicely into rvest functionality for more processing. Here the package’s <span class="func">page_content</span> function will extract information from the page. The ‘text’ element is the html content, which we can then feed to the previously used <span class="pack">rvest</span> functions. I show only a snippet of the output.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(WikipediR)
r_wikipedia =<span class="st"> </span><span class="kw">page_content</span>(<span class="dt">language=</span><span class="st">&#39;en&#39;</span>, <span class="st">&#39;wikipedia&#39;</span>, <span class="dt">page_name =</span> <span class="st">&#39;R_(programming_language)&#39;</span>)
<span class="kw">str</span>(r_wikipedia[[<span class="dv">1</span>]], <span class="dv">1</span>) <span class="co"># inspect</span>


r_wikipedia$parse$text$<span class="st">`</span><span class="dt">*</span><span class="st">`</span> %&gt;%<span class="st"> </span>
<span class="st">  </span>read_html %&gt;%<span class="st"> </span>
<span class="st">  </span>html_text %&gt;%<span class="st"> </span>
<span class="st">  </span>message</code></pre></div>
<p><img src="img/rpage.png" style="display:block; margin: 0 auto;"></p>
</div>
<div id="qualtrics" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Qualtrics</h3>
<p>Qualtrics is a survey software which one can use to create and disseminate surveys and the data from them, and is a very useful tool in this regard. The University of Michigan has a license, and so anyone at the university can use it, which is why I provide a generic example here.</p>
<p>The <span class="pack">qualtricsR</span><a href="#fn11" class="footnoteRef" id="fnref11"><sup>11</sup></a> package makes it easy to import data from and export surveys to Qualtrics, as well as functionality to create a standard survey within R. As before you’ll need proper authorization, but then it can be straightforward to grab your data from Qualtrics without having to go to the website.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydata =<span class="st"> </span><span class="kw">importQualtricsData</span>(<span class="dt">username =</span> <span class="st">&quot;qualtricsUser@email.address#brand&quot;</span>,  <span class="co"># example micl@umich.edu#umich</span>
                             <span class="dt">token =</span> <span class="st">&quot;tokenString&quot;</span>, <span class="dt">surveyID =</span> <span class="st">&quot;idString&quot;</span>)    <span class="co"># your token from Qualtrics</span></code></pre></div>
</div>
<div id="others" class="section level3">
<h3><span class="header-section-number">2.2.4</span> Others</h3>
<p>Note that there are many R packages that work with various APIs, so if you’re looking to work with data from a site that has an API, definitely see if something already exists.</p>
</div>
</div>
<div id="issues-1" class="section level2">
<h2><span class="header-section-number">2.3</span> Issues</h2>
<div id="documentation" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Documentation</h3>
<p>One issue I commonly find with APIs is that often they are generally poorly documented beyond a certain level of initial detail, e.g. often telling you what the parameters are but not the values they can take on. As an example, if something says it wants a date, you may be left to figure out what date format is expected. Just be aware that you may still have some guesswork left even if a lot of information is provided initially.</p>
</div>
<div id="api-changes" class="section level3">
<h3><span class="header-section-number">2.3.2</span> API Changes</h3>
<p>Many websites cannot leave the API alone very long. Sometimes this is due to actual content changes that require subsequent changes in the API, sometimes it might reflect a server side issue that needs to be addressed. Often a reason isn’t given. The gist is that you shouldn’t be surprised if an API package in R doesn’t work if it hasn’t been updated recently. As the code is often pretty straightforward, you may be able to easily tweak a function to work with the current API.</p>
</div>
<div id="broken-api" class="section level3">
<h3><span class="header-section-number">2.3.3</span> Broken API</h3>
<p>Sometimes someone fiddles with things they shouldn’t and you start getting errors. As an example, while developing this document, NY times article search would start providing different errors depending on the combination of start and end date (forbidden, api rate exceeded, no content etc.). It is not necessarily the case that you are doing something incorrectly.</p>
</div>
<div id="restrictions" class="section level3">
<h3><span class="header-section-number">2.3.4</span> Restrictions</h3>
<p>Note that there are almost always restrictions. For example, the New York Times API limits requests to 1000 calls per day, and five calls per second. Unfortunately these are typically not based on actual testing of what modern servers could handle and are often overly restrictive (and overly optimistic in estimates of web traffic) in my opinion. I mention it though because you’ll need to plan ahead. If you need a 1 million requests, but the API restricts you to 1000 a day, you’ll obviously need some other way to get the data you want. A simple request to the website developers for more flexibility might be all that is needed.</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="8">
<li id="fn8"><p>Technically <span class="emph">uniform resource locator</span>.<a href="apis.html#fnref8">↩</a></p></li>
<li id="fn9"><p>The reason you don’t see the key is that, like passwords, you should not provide your keys to others. They provide a means for <em>you</em> to interact with the website, not other people.<a href="apis.html#fnref9">↩</a></p></li>
<li id="fn10"><p>There are several APIs for different types of content.<a href="apis.html#fnref10">↩</a></p></li>
<li id="fn11"><p><a href="https://github.com/saberry/qualtricsR" class="uri">https://github.com/saberry/qualtricsR</a><a href="apis.html#fnref11">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="web-scraping.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualization.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/02_APIs.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"highlight": "pygments"
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
