<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Engaging the Web with...</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="An introduction to using R for the web.">
  <meta name="generator" content="bookdown 0.1 and GitBook 2.6.7">

  <meta property="og:title" content="Engaging the Web with..." />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An introduction to using R for the web." />
  <meta name="github-repo" content="m-clark/Workshops" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Engaging the Web with..." />
  
  <meta name="twitter:description" content="An introduction to using R for the web." />
  


<meta name="date" content="2016-11-24">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="web-scraping.html">
<link rel="next" href="visualization.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-0.7/htmlwidgets.js"></script>
<link href="libs/plotlyjs-1.16.3/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotlyjs-1.16.3/plotly-latest.min.js"></script>
<script src="libs/plotly-binding-4.5.2/plotly.js"></script>
<link href="libs/leaflet-0.7.3/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-0.7.3/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/leaflet-binding-1.0.1/leaflet.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="webR.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://m-clark.github.io/docs/web/"><span style="font-size:150%; font-variant:small-caps; font-style:italic; color:#ff5503">webR</span></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="web-scraping.html"><a href="web-scraping.html"><i class="fa fa-check"></i>Web scraping</a><ul>
<li class="chapter" data-level="" data-path="web-scraping.html"><a href="web-scraping.html#direct-data-download"><i class="fa fa-check"></i>Direct data download</a></li>
<li class="chapter" data-level="" data-path="web-scraping.html"><a href="web-scraping.html#key-concepts"><i class="fa fa-check"></i>Key concepts</a></li>
<li class="chapter" data-level="" data-path="web-scraping.html"><a href="web-scraping.html#the-basic-approach"><i class="fa fa-check"></i>The basic approach</a></li>
<li class="chapter" data-level="" data-path="web-scraping.html"><a href="web-scraping.html#examples"><i class="fa fa-check"></i>Examples</a><ul>
<li class="chapter" data-level="" data-path="web-scraping.html"><a href="web-scraping.html#tables"><i class="fa fa-check"></i>Tables</a></li>
<li class="chapter" data-level="" data-path="web-scraping.html"><a href="web-scraping.html#text"><i class="fa fa-check"></i>Text</a></li>
<li class="chapter" data-level="" data-path="web-scraping.html"><a href="web-scraping.html#images"><i class="fa fa-check"></i>Images</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="web-scraping.html"><a href="web-scraping.html#issues"><i class="fa fa-check"></i>Issues</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="apis.html"><a href="apis.html"><i class="fa fa-check"></i>APIs</a><ul>
<li class="chapter" data-level="" data-path="apis.html"><a href="apis.html#raw-example"><i class="fa fa-check"></i>Raw Example</a></li>
<li class="chapter" data-level="" data-path="apis.html"><a href="apis.html#r-packages"><i class="fa fa-check"></i>R packages</a><ul>
<li class="chapter" data-level="" data-path="apis.html"><a href="apis.html#new-york-times-article-search"><i class="fa fa-check"></i>New York Times Article Search</a></li>
<li class="chapter" data-level="" data-path="apis.html"><a href="apis.html#wikipedia-1"><i class="fa fa-check"></i>Wikipedia</a></li>
<li class="chapter" data-level="" data-path="apis.html"><a href="apis.html#qualtrics"><i class="fa fa-check"></i>Qualtrics</a></li>
<li class="chapter" data-level="" data-path="apis.html"><a href="apis.html#others"><i class="fa fa-check"></i>Others</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="apis.html"><a href="apis.html#issues-1"><i class="fa fa-check"></i>Issues</a><ul>
<li class="chapter" data-level="" data-path="apis.html"><a href="apis.html#documentation"><i class="fa fa-check"></i>Documentation</a></li>
<li class="chapter" data-level="" data-path="apis.html"><a href="apis.html#api-changes"><i class="fa fa-check"></i>API Changes</a></li>
<li class="chapter" data-level="" data-path="apis.html"><a href="apis.html#broken-api"><i class="fa fa-check"></i>Broken API</a></li>
<li class="chapter" data-level="" data-path="apis.html"><a href="apis.html#restrictions"><i class="fa fa-check"></i>Restrictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i>Visualization</a><ul>
<li class="chapter" data-level="" data-path="visualization.html"><a href="visualization.html#systems"><i class="fa fa-check"></i>Systems</a><ul>
<li class="chapter" data-level="" data-path="visualization.html"><a href="visualization.html#plotly"><i class="fa fa-check"></i>plotly</a></li>
<li class="chapter" data-level="" data-path="visualization.html"><a href="visualization.html#rbokeh"><i class="fa fa-check"></i>rbokeh</a></li>
<li class="chapter" data-level="" data-path="visualization.html"><a href="visualization.html#others-1"><i class="fa fa-check"></i>Others</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="visualization.html"><a href="visualization.html#htmlwidgets"><i class="fa fa-check"></i>htmlwidgets</a><ul>
<li class="chapter" data-level="" data-path="visualization.html"><a href="visualization.html#leaflet-example"><i class="fa fa-check"></i>Leaflet example</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="visualization.html"><a href="visualization.html#shiny"><i class="fa fa-check"></i>Shiny</a><ul>
<li class="chapter" data-level="" data-path="visualization.html"><a href="visualization.html#server"><i class="fa fa-check"></i>Server</a></li>
<li class="chapter" data-level="" data-path="visualization.html"><a href="visualization.html#ui"><i class="fa fa-check"></i>UI</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="visualization.html"><a href="visualization.html#dashboards"><i class="fa fa-check"></i>Dashboards</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html"><i class="fa fa-check"></i>Publishing</a><ul>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html#publishing-languages"><i class="fa fa-check"></i>Publishing Languages</a><ul>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html#markdown"><i class="fa fa-check"></i>Markdown</a></li>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html#r-markdown"><i class="fa fa-check"></i>R Markdown</a></li>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html#html-css-etc."><i class="fa fa-check"></i>HTML, CSS etc.</a></li>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html#latex"><i class="fa fa-check"></i>LaTeX</a></li>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html#yaml"><i class="fa fa-check"></i>YAML</a></li>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html#pandoc"><i class="fa fa-check"></i>Pandoc</a></li>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html#summary"><i class="fa fa-check"></i>Summary</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html#document-formats"><i class="fa fa-check"></i>Document Formats</a><ul>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html#html"><i class="fa fa-check"></i>HTML</a></li>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html#notebooks"><i class="fa fa-check"></i>Notebooks</a></li>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html#print"><i class="fa fa-check"></i>Print</a></li>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html#journals"><i class="fa fa-check"></i>Journals</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html#presentations"><i class="fa fa-check"></i>Presentations</a></li>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html#other-formats"><i class="fa fa-check"></i>Other formats</a></li>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html#other"><i class="fa fa-check"></i>Other</a><ul>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html#customization"><i class="fa fa-check"></i>Customization</a></li>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html#rpubs"><i class="fa fa-check"></i>Rpubs</a></li>
<li class="chapter" data-level="" data-path="publishing.html"><a href="publishing.html#more"><i class="fa fa-check"></i>More</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i>Conclusion</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://m-clark.github.io" target="blank" style="font-size:150%; font-variant:small-caps; color:#ff5500">Michael Clark</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank" style="font-size:75%;">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><span style="font-size:150%; font-variant:small-caps; font-style:italic; color:#1e90ff">Engaging the Web with... </span></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="apis" class="section level1">
<h1>APIs</h1>
<p>An <span class="emph">application programming interface</span> allows one to interact with a website<a href="#fn9" class="footnoteRef" id="fnref9"><sup>9</sup></a>. In the simplest situation, this is merely a url-based approach to grabbing what you need.</p>
<p>As an example consider the following generic URL:</p>
<p><code>http://somewebsite.com/key?par1;par2</code></p>
<p>The key ingredients are:</p>
<ul>
<li><code>http://somewebsite.com/</code> the base URL</li>
<li><code>key</code> some authorization component</li>
<li><code>?par1;par2</code> the parameters of interest that specify what you want to grab from that website.</li>
</ul>
<p>With R, once we have authorization we can then simply feed the parameters that tell the server what data to provide. We can do this in a raw fashion, where we make the URL, or web address<a href="#fn10" class="footnoteRef" id="fnref10"><sup>10</sup></a>, that has the necessary specification, and then simply take what it provides. Alternatively, there are many R packages to make the process easier for things like Twitter, Qualtrics, and many other websites.</p>
<div id="raw-example" class="section level2">
<h2>Raw Example</h2>
<p>Basic functions of the raw approach are requests to a server things like GET and POST, commands that tell the server to provide something or perhaps provide data to it. In the following, <span class="objclass">api_key</span><a href="#fn11" class="footnoteRef" id="fnref11"><sup>11</sup></a> is an R object with a character string of the key provided to me by the website. I use the <span class="pack">httr</span> package for the web functionality to acquire the content. In particular, the <span class="func">GET</span> function retrieves whatever information is noted by the request/url. Additional arguments or modifications to the base URL can also be provided, which is what the <code>query</code> part does.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># raw approach</span>
<span class="kw">library</span>(httr)
most_viewed_base =<span class="st"> </span><span class="kw">GET</span>(<span class="st">&#39;https://api.nytimes.com/svc/mostpopular/v2/mostviewed/all-sections/30.json&#39;</span>, <span class="dt">query=</span><span class="kw">list</span>(<span class="st">`</span><span class="dt">api-key</span><span class="st">`</span>=api_key))
<span class="co"># see the url created</span>
<span class="co"># most_viewed_base$url # tacks on ?api-key=YOURAPI at the end</span></code></pre></div>
<p>At this point, <span class="objclass">most_viewed_base</span> is a <span class="objclass">response</span> class object, a list with several pieces of information including what we want, which is the content.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(most_viewed_base[-<span class="dv">1</span>], <span class="dv">1</span>)</code></pre></div>
<pre><code>List of 9
 $ status_code: int 200
 $ headers    :List of 15
  ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;insensitive&quot; &quot;list&quot;
 $ all_headers:List of 1
 $ cookies    :&#39;data.frame&#39;:    0 obs. of  7 variables:
 $ content    : raw [1:54087] 7b 22 73 74 ...
 $ date       : POSIXct[1:1], format: &quot;2016-10-16 18:25:01&quot;
 $ times      : Named num [1:6] 0 0.063 0.11 0.219 0.64 0.718
  ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;redirect&quot; &quot;namelookup&quot; &quot;connect&quot; &quot;pretransfer&quot; ...
 $ request    :List of 7
  ..- attr(*, &quot;class&quot;)= chr &quot;request&quot;
 $ handle     :Class &#39;curl_handle&#39; &lt;externalptr&gt; </code></pre>
<p>However the content’s in <span class="emph">binary</span>, and to get it into a useful state we’ll use the <span class="func">content</span> function. The rest of the code just takes the title and arranges it by date.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">most_viewed =<span class="st"> </span><span class="kw">content</span>(most_viewed_base)
<span class="kw">lapply</span>(most_viewed$results, function(x) <span class="kw">data_frame</span>(<span class="dt">title=</span>x$title, <span class="dt">date=</span>x$published_date)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">bind_rows</span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(date))</code></pre></div>
<pre><code># A tibble: 20 × 2
                                                                                               title       date
                                                                                               &lt;chr&gt;      &lt;chr&gt;
1                                                                         Latest Election Polls 2016 2016-10-16
2                                                     2016 Election Forecast: Who Will Be President? 2016-10-16
3                                            Two Women Say Donald Trump Touched Them Inappropriately 2016-10-13
4                                               The New York Timess Lawyer Responds to Donald Trump 2016-10-13
5                                                                    Donald Trumps Sad, Lonely Life 2016-10-11
6                             Paul Ryan Turns Focus From Donald Trump to House Races, Roiling G.O.P. 2016-10-11
7                                                        Presidential Debate: Heres What You Missed 2016-10-10
8                                                      Fact Checks of the Second Presidential Debate 2016-10-09
9                                                                      Donald Trump, Groper in Chief 2016-10-09
10                                           Donald Trump Apology Caps Day of Outrage Over Lewd Tape 2016-10-08
11                                          A Letter to the Doctors and Nurses Who Cared for My Wife 2016-10-06
12 Donald Trump Tax Records Show He Could Have Avoided Taxes for Nearly Two Decades, The Times Found 2016-10-02
13                                     After a Disappointing Debate, Donald Trump Goes on the Attack 2016-09-28
14                                     Did You Miss the Presidential Debate? Here Are the Highlights 2016-09-27
15                                                               Our Fact Checks of the First Debate 2016-09-27
16                                                          Why Donald Trump Should Not Be President 2016-09-26
17                                            Video by Wife of Keith Scott Shows Her Pleas to Police 2016-09-24
18                                          Angelina Jolie to Divorce Brad Pitt, Ending Brangelina 2016-09-22
19                                Ahmad Khan Rahami Is Arrested in Manhattan and New Jersey Bombings 2016-09-20
20                              Powerful Blast Injures at Least 29 in Manhattan; Second Device Found 2016-09-18</code></pre>
<p>The community API can get user comments and movie reviews. In the following case, it will need a specific date to retrieve comments.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">comments_base =<span class="st"> </span><span class="kw">GET</span>(<span class="st">&#39;http://api.nytimes.com/svc/community/v3/user-content/by-date.json&#39;</span>, <span class="dt">query=</span><span class="kw">list</span>(<span class="dt">date=</span><span class="kw">Sys.Date</span>()))
comments =<span class="st"> </span><span class="kw">content</span>(comments_base)
<span class="kw">sapply</span>(comments$results$comments, function(x) x$commentBody)[<span class="dv">1</span>:<span class="dv">5</span>]</code></pre></div>
<pre><code>[1] &quot;Until the popular pressures from below force the ruling Saudi dynasty to undertake such democratic reforms as could widen popular participation in decision making and unshacle the society from the repressive tradition rooted in obscurantist social religious practices, the cosmetic reforms being pushed by the Deputy Crown Prince Salmon would mean nothing except a part of power struggle to gain supremacy. &quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
[2] &quot;Martin, I did the puzzle tonight while watching the game. Tis a far, far better thing what Montero did than he has ever done before.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
[3] &quot;Higher pays and bigger chances of advancedment could pay off when two conditions are met. &lt;br/&gt;&lt;br/&gt;First,  a pay rise is meaninful in relative terms, not absolute terms as time progresses. &lt;br/&gt;&lt;br/&gt;The morale for employess is boosted when they are paid higher at their jobs than other similar jobs. &lt;br/&gt;&lt;br/&gt;If they could get an equivalent pay at another job,  they couldn&#39;t find any reason to work hard. That is, they could leave the job in favor of another one with a greater pay. &lt;br/&gt;&lt;br/&gt;The implication is that job morale stimulating efficiency wage matters when it is bigger than on average and that, if average wage levels in an industry rise to a point of no significant differences, its impact could noticeably decline, with increased consumers prices levels. &lt;br/&gt;&lt;br/&gt;Second, even if higer paid employees work hard, the resulting hike in sales and profit for employers is possible when the economy is high.  In a slow economy, higher pays would put more of a burden on employers as the aggregate demand is meager. &lt;br/&gt;&lt;br/&gt;So employers are tempted to downsize and cut payroll even if such action could trigger a vicious cycle of recession. After all, businesses are just profit maximizers, not a coordinator of macroeconomic order. &lt;br/&gt;&lt;br/&gt;Finally, if a business is on the export side, raising pays for workers will be less likely. In a globalized cutthroat competition, price is often a determinant of competitveness, thus higher labor costs leading to higher prices, lower sales. &lt;br/&gt;&lt;br/&gt;In short, the issue is really tough.&quot;
[4] &quot;This kind of comparison has occurred to me as well. There are really too many points to compare--another that comes to mind is, what if Hillary Clinton dodged every question and criticism by bringing up an angry charge about her opponent&#39;s history? And never, ever, accepted the blame for anything?&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
[5] &quot;Mr. Trump is old, old school. Instead of Mrs. Clinton&#39;s name, substitute the name of any modern male presidential candidate. Imagine the howls? Somehow, this man has tapped into an ugly American vein where his adherents will minimize and justify any behavior no matter how lurid. Still, others, will blindly vote Republican no matter what. Millions of Americans are voting for this lunatic. I say, Love it, or move back to Europe.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </code></pre>
<p>The API documentation doesn’t make obvious what the date format should be, how the comments are chosen (aside from being taken from some section of the paper), or what the limits are. As mentioned previously, this is typical API documentation in my experience.</p>
</div>
<div id="r-packages" class="section level2">
<h2>R packages</h2>
<p>Many R packages allow extremely easy access to various websites through their API. Usually all it takes is acquiring the authorization and the package will do the rest. It might only be marginally less effort than the raw approach we did before, but can make things more efficient in the long run (assuming the package is kept up to date).</p>
<div id="new-york-times-article-search" class="section level3">
<h3>New York Times Article Search</h3>
<p>The following is an example of accessing the New York Times article search API<a href="#fn12" class="footnoteRef" id="fnref12"><sup>12</sup></a>. Using the <span class="pack">rtimes</span> package, we can use a function similar to any other in R. In this case we need a query, beginning date and an end date to collect articles that contain the text of the query. Note that it still requires an key, but that’s not shown here.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rtimes)
article_search =<span class="st"> </span><span class="kw">as_search</span>(<span class="dt">q=</span><span class="st">&quot;bomb&quot;</span>, <span class="dt">begin_date =</span> <span class="st">&#39;20160918&#39;</span>, <span class="dt">end_date =</span> <span class="st">&#39;20160919&#39;</span>)[-(<span class="dv">1</span>:<span class="dv">2</span>)]

<span class="kw">lapply</span>(article_search$data, function(x) <span class="kw">data_frame</span>(<span class="dt">snippet=</span>x$snippet, <span class="dt">date=</span> x$pub_date)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">bind_rows</span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(date))</code></pre></div>
<pre><code># A tibble: 10 × 2
                                                                                                                    snippet
                                                                                                                      &lt;chr&gt;
1  New York City police investigating a bombing in Manhattan over the weekend said on Monday they wanted to question two me
2  Long before Ahmad Rahami became notorious as the suspect in this weekend&#39;s bombings in and around New York, his family w
3  Syrian or Russian warplanes bombed the city of Aleppo and nearby villages on Monday, the Syrian Observatory for Human Ri
4  Democrat Hillary Clinton on Monday accused Republican Donald Trump of aiding Islamic State recruitment, while Trump said
5                                              The Latest on explosive devices being found in two states (all times local):
6  Mayor J. Christian Bollwage of Elizabeth, N.J., described how a bag containing pipe bombs was discovered near a train st
7  Amnesty International says it has evidence that a Saudi-led coalition battling Yemeni rebels dropped a U.S.-made bomb on
8  Saturday nights explosion in the Chelsea neighborhood of Manhattan occurred just outside a building that is home to man
9  The authorities used a total containment vessel to haul the device to the Bronx before passing it along to the Federal
10 A Somali general and at least seven of his bodyguards were killed on Sunday when their vehicle was rammed by a car bomb 
# ... with 1 more variables: date &lt;chr&gt;</code></pre>
</div>
<div id="wikipedia-1" class="section level3">
<h3>Wikipedia</h3>
<p>With the <span class="pack">WikipediR</span> package, getting the whole content of a page is just one possibility, and it feeds nicely into <span class="pack">rvest</span> functionality for more processing. Here the package’s <span class="func">page_content</span> function will extract information from the page. The ‘text’ element is the html content, which we can then feed to the previously used <span class="pack">rvest</span> functions. I show only a snippet of the output.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(WikipediR)
r_wikipedia =<span class="st"> </span><span class="kw">page_content</span>(<span class="dt">language=</span><span class="st">&#39;en&#39;</span>, <span class="st">&#39;wikipedia&#39;</span>, <span class="dt">page_name =</span> <span class="st">&#39;R_(programming_language)&#39;</span>)
<span class="kw">str</span>(r_wikipedia[[<span class="dv">1</span>]], <span class="dv">1</span>) <span class="co"># inspect</span>


r_wikipedia$parse$text$<span class="st">`</span><span class="dt">*</span><span class="st">`</span> %&gt;%<span class="st"> </span>
<span class="st">  </span>read_html %&gt;%<span class="st"> </span>
<span class="st">  </span>html_text %&gt;%<span class="st"> </span>
<span class="st">  </span>message</code></pre></div>
<p><img src="img/rpage.png" style="display:block; margin: 0 auto;"></p>
</div>
<div id="qualtrics" class="section level3">
<h3>Qualtrics</h3>
<p>Qualtrics is a survey software which one can use to create and disseminate surveys and the data from them, and is a very useful tool in this regard. The University of Michigan has a license, and so anyone at the university can use it, which is why I provide a generic example here.</p>
<p>The <span class="pack">qualtricsR</span><a href="#fn13" class="footnoteRef" id="fnref13"><sup>13</sup></a> package makes it easy to import data from and export surveys to Qualtrics, as well as functionality to create a standard survey within R. As before you’ll need proper authorization, but then it can be straightforward to grab your data from Qualtrics without having to go to the website.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(qualtricsR)
mydata =<span class="st"> </span><span class="kw">importQualtricsData</span>(<span class="dt">username =</span> <span class="st">&quot;qualtricsUser@email.address#brand&quot;</span>,  <span class="co"># example micl@umich.edu#umich</span>
                             <span class="dt">token =</span> <span class="st">&quot;tokenString&quot;</span>, <span class="dt">surveyID =</span> <span class="st">&quot;idString&quot;</span>)    <span class="co"># your token from Qualtrics</span></code></pre></div>
</div>
<div id="others" class="section level3">
<h3>Others</h3>
<p>Note that there are many R packages that work with various APIs, so if you’re looking to work with data from a site that has an API, definitely see if something already exists. If it is a very popular website, you are probably not the first person using R that wants to access its data.</p>
</div>
</div>
<div id="issues-1" class="section level2">
<h2>Issues</h2>
<div id="documentation" class="section level3">
<h3>Documentation</h3>
<p>One issue I commonly find with APIs is that often they are generally poorly documented beyond a certain level of initial detail, e.g. often telling you what the parameters are but not the values they can take on. As an example, if something says it wants a date, you may be left to figure out what date format is expected. Sometimes I feel that developers spend so little effort it seems they don’t actually want people to use the API. Just be aware that you may still have some guesswork left even when a lot of information is provided initially.</p>
</div>
<div id="api-changes" class="section level3">
<h3>API Changes</h3>
<p>Many websites cannot leave the API alone very long. Sometimes this is due to actual content changes that require subsequent changes in the API, sometimes it might reflect a server side issue that needs to be addressed. Often a reason isn’t given. The gist is that you shouldn’t be surprised if an API package in R doesn’t work if it hasn’t been updated recently. As the code is often pretty straightforward, you may be able to easily tweak a function to work with the current API.</p>
</div>
<div id="broken-api" class="section level3">
<h3>Broken API</h3>
<p>Sometimes someone fiddles with things they shouldn’t and you start getting errors. As an example, while developing this document, NY times article search would start providing different errors depending on the combination of start and end date (forbidden, API rate exceeded, no content etc.). It is not necessarily the case that you are doing something incorrectly.</p>
</div>
<div id="restrictions" class="section level3">
<h3>Restrictions</h3>
<p>Note that there are almost always restrictions. For example, the New York Times API limits requests to 1000 calls per day, and five calls per second. Unfortunately these are typically not based on actual testing of what modern servers could handle and are often overly restrictive (and overly optimistic in estimates of web traffic) in my opinion. I mention it though because you’ll need to plan ahead. If you need a 1 million requests, but the API restricts you to 1000 a day, you’ll obviously need some other way to get the data you want. A simple request to the website developers for more flexibility might be all that is needed.</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="9">
<li id="fn9"><p><a href="https://en.wikipedia.org/wiki/Application_programming_interface">APIs</a> are much more general than just the Web version described here, in that they allow a means of interaction with anything- operating system, software, hardware etc. For our purposes though, it usually boils down to the examples above.<a href="apis.html#fnref9">↩</a></p></li>
<li id="fn10"><p>Technically <span class="emph">uniform resource locator</span>.<a href="apis.html#fnref10">↩</a></p></li>
<li id="fn11"><p>The reason you don’t see the key is that, like passwords, you should not provide your keys to others. They provide a means for <em>you</em> to interact with the website, not other people.<a href="apis.html#fnref11">↩</a></p></li>
<li id="fn12"><p>There are several APIs for different types of content.<a href="apis.html#fnref12">↩</a></p></li>
<li id="fn13"><p><a href="https://github.com/saberry/qualtricsR" class="uri">https://github.com/saberry/qualtricsR</a><a href="apis.html#fnref13">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="web-scraping.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualization.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": false,
"twitter": false,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": false,
"download": null,
"toc": {
"collapse": "subsection"
},
"highlight": "pygments",
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
